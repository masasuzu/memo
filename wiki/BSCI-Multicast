! BSCI-Multicast

{{toc_here}}


!! multicastの利点
* 複数の受信者に同じデータを送信できるため、ネットワーク帯域を効率的に活用できる。
* リアルタイム性が要求されるテレビ会議などの映像配信に向いている

!! マルティキャストアドレス
* マルティキャストアドレスの先頭4ビットは1110に決められている。
* 先頭4ビット以外はグループIDとなる
* 10進数表記で224.0.0.0 〜 239.255.255.255の範囲となる
* 224.0.0.0 〜 224.0.0.255はリンクローカルアドレスである
* 224.0.1.0 〜 238.255.255.255はグローバルスコープアドレスである
* 239.0.0.0 〜 239.255.255.255は限定スコープアドレスである
* クラスDアドレスである

* 先頭24ビットが01-00-5eのMACアドレス

!! IGMP
* ホストとルータ間でやりとりするためのアドレス
* ホストがマルティキャストグループに加入したいときに使用する
* 定期的に224.0.0.1にメンバーシップクエリを送信する

: メンバーシップレポート:
:: マルティキャストグループに参加する際、送信されるIGMPメッセージ

!!! IGMPv2
* クエリア選出メカニズム
* グループ指定クエリ
* グループ脱退メッセージ
* クエリ間隔の応答時間


!!! IGMPv3
* 送信元フィルタリング


!! CGMP
* シスコ独自のプロトコル
* マルティキャストルータとスイッチの間で動作
* ホストからIGMPメッセージを受信したルータはCGMPパケットに変換してスイッチに通知する
* CGMPパケットの宛先MACアドレスは0100.0cdd.dddd
* ルータから受信したCGMPパケット情報は。CAMテーブルに追加または削除される


!! IGMPスヌーピング
* ホストがルータにIGMP joinを送信するときにスイッチがそのパケットをのぞき見すること
* L2スイッチにおけるマルティキャストのフラッディング問題を解決
* スループットを維持するために特別なハードウェアが必要

!! マルティキャストディストリビューションツリー
* ディストリビューションツリーのタイプ
** 送信元ツリー
** 共有ツリー

* ディストリビューションツリーは送信元から受信者までのパスを定義する
* 送信元ツリーでは送信元から受信者への最短パスが保証される


!! PIM
* PIM Denseモードのインターフェースは常にルータのマルチキャストルーティングテーブルに加えられる
* PIM 希薄-稠密モードはRPがわからない場合は、PIM 稠密モードとして動作する
* PIM SparseモードとPIM 希薄-稠密モードはネットワーク上にRPが必要である


* Helloは30秒間隔
* DRは最も大きなIPアドレスを持つルータ
** PtPネットワークでは選出されない


!!! Dense Mode
* フラッドアンドプルーン
** 定期的なフラッディングとプルーニング
* (S,G)エントリのみ使用してマルティキャストトラフィックを転送する。



!!! Sparse Mode
* ネイバールータがマルティキャストパケットの転送を希望しない場合に使用。
* マルティキャストパケットの転送を要求されたときのみ転送。* ランデブーポイントが必要



!! マルティキャストの設定

!!! ルータでマルティキャストルーティングを有効化
 (config)# ip multicast-routing

!!! I/Fでマルティキャストを有効化
 (config-if)# ip pim {sparse-mode|dense-mode|sparse-dense-mode}

!!! 手動でRPアドレスを設定
 (config)# ip pim rp-address <ip-address> [acl-number]

* ACLを設定した場合、特定のマルティキャストグループだけのRPを指定することができる。




!! 設定の確認

!!! マルティキャストルーティングテーブルを確認
 # show ip mroute

!!! アクティブなマルティキャストグループとRPのリストを表示
 # show ip pim rp

!!! マルティキャストグループの範囲ごとにRPを表示、ルータがどのようにRPを検出したのかを確認

 # show ip pim rp mapping

!!! RPまたはソースに関するRFP情報を表示
 # show ip rpf {name|adress}

!!! PIMが有効なインタフェースに関する情報を表示

 # show ip pim interface
