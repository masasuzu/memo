! ネットワーク要件
!! エンタープライズコンポジットネットワークモデル
!!! エンタープライズキャンパス機能領域
* ビルディングアクセス
* ビルディングディストリビューション
* キャンパスバックボーン
* ネットワーク管理
* サーバファーム
* エッジディストリビューション

!!! エンタープライズエッジ機能領域
* Eコマース
* インターネット接続
* リモートアクセスおよびVPN
* WAN

!!! サービスプロバイダエッジ機能領域
* ISP
* PSTN
* FR/ATM

! テレワーカーの接続性
!! ケーブルテクノロジー
!!! ブロードバンドケーブルの変調方式
* SECAM
* PAL
* NTSC


!! DSLテクノロジー
: DSL:
:: 通常の電話線を使用したデジタル通信技術の総称
:: 最大伝送距離は18000フィート(5.5km)

: ATU-R(ADSL Terminal Unit-Remote):
:: ユーザ宅のADSLモデムを表す

: スプリッタ:
:: ADSLにおいてデータチャネルと音声チャネルを分離する機器

!! DSL接続の最大可能速度を下げる物理要因
* CPEからDSLAMまでの距離
* ローカル ループで使用されるワイヤのゲージ


!!! ADSLの変調方式
: CAP変調(Carrierless Amplitude and Phase変調):
:: 信号を音声チャネル、アップストリームチャネル、ダウンストリームチャネルの3つに分ける

: DMT変調(Miscrete MultiTone変調):
:: 4kHzごとに分割した256個のチャネルに周波数帯を分割する

!!! カプセル化方式
: RFC 1483/2684 Bridged:
:: イーサネットフレームを直接AAL5でカプセル化し、集約ルータへブリッジします。
:: 拡張性に乏しく、ユーザ認証等のセキュリティ機能がない

: PPPoE:
:: イーサネットフレームをPPPでカプセル化

!!!! PPP
: ディスカバリステージ:
:: ポイントツーポイント接続を確立する集約ルータを発見する

: PPPセッションステージ:
:: CHAP認証やIPアドレス配布などが実行される

* PPPoEのMTUは1492



!! PPPoEまたはPPPoAクライアントとしてのCPEの設定
!!! PPPoEのEth I/Fへの設定
 (config-if)# pppoe enable
 (config-if)# pppie-client dial-pool-number <number>

!!! PPPoEのDialar I/Fへの設定
 (config-if)# dialer pool <number>

!!! PPPoAのカプセル化を設定
 (config-if) encapsulation aal5mux ppp dialer

!!! DSL ATM I/FとDialer I/Fを対応付ける
 (config-if) dialer pool-menmber <number>

!! ADSLの利点
* 既存の電話回線を利用して高速データ通信を行うことができる
* 電話と共存できる

! フレームモードMPLSの実装
!! コントロールプレーン
* IPルーティングプロセス
* ルートテーブル(RIB)
* MPLSプロセス
* LIB

!! データプレーン
* IP転送テーブル(FIB)
* ラベル転送テーブル(LFIB)

!! MPLS VPN
* サイトツーサイトが不要なので、非常にスケーラブル
* ユーザがネットワークに接続するのにVPNクライアントが必要ない
* Route TargetはVPNグループメンバシップをしめるためにVPN V4 BGPルートにつけられた属性






! IPSecコンポーネントとIPSecVPN機能
: IPSec :
:: IETFによって標準化されたセキュリティ技術
:: 既存のアプリケーションに変更を加える必要がない
:: 特定の暗号化アルゴリズムに依存しない
:: IPSecそのものは複雑

!! ESPとAH

: ESP:
:: プロトコル番号50
:: 機密性、整合性、認証、アンチリプレイ
:: 認証はオブションでヘッダの外は認証されていない
:: ESPはデータの機密性を提供する
:: IPパケットはトランスポートモードで37バイト(3DES)、もしくは63ばいと(AES)拡張され、トンネルモードでは57バイト(3DES)、もしくは83バイト(AES)拡張される。


: AH:
:: プロトコル番号51
:: セキュリティ、整合性、認証、アンチリプレイ

!! IPSecのモード
* ステップバイステップウィザードのフェーズ2プロポーザル設定画面もしくはVPNコンポーネントを使用して変更することが可能

: トンネルモード:
:: オリジナルのIPヘッダを隠蔽することができる

: トランスペアレントモード:
:: 


!! IKE
: SA:
:: データフローに適用されるセキュリティーポリシーおよび鍵生成情報のセット
:: IKEとIPSecはどちらもSAを使用し、双方のSAは互いに独立している
:: IPsec SAは単方向であり、セキュリティープロトコルごとに一意

: 暗号ACL:
:: 保護されるトラフィックフローを識別
:: IPSecピアで正反対に設定されるべき

* IKEキープアライブは単方向に10秒ごとに送信される
* IKEはIPsecピアに使用される対象鍵を生成するのにディフィーへルマンアルゴリズムを使用する。
* IKE SAを確立するために、Aggressiveモードは3パケットだけ利用するが、Mainモードは6パケットを利用する

* DH交換は、2つのピアに不安定な通信チャネル上で共有秘密鍵を共同で確立させる

!!! IKEの利点
* 両方のピアノ暗号マップに、IPSecセキュリティ パラメータを手動で指定する必要がない
* IPSecセキュリティ結合のライフタイムを指定できる
* IPSecセッション中に暗号鍵を変更できる
* IPSecによるリプレイ攻撃防止サービスが可能
* 管理可能でスケーラブルなIPSec実装形式のCAサポートが可能
* ピアノダイナミック認証が可能


!!! GRE on IPSec
* 暗号ACLは、2つのIPSecピア感でGREトラフィックが暗号化されるように指定する
* トンネルインターフェース上でダイナミックルーティングプロトコルを動作させるよう設定できる
* 暗号マップは物理インターフェース上で適用されなければならない


!!! SAの設定
: 手動設定:
:: 

: 自動設定:
:: IKEなどのSAを自動生成するプロトコルを使用して、動的にSAパラメータの共有を行う
:: 手動設定より安全

!!! IKEによるSA生成順序
# IKEフェーズ1
# ISAKMPの生成
# IKEフェーズ2
# IPSecSAの生成

!!! IKEフェーズ1
* IPSecピアの身元を認証して保護します
* IKE交換を保護するためにピア間で一致するIKE SAポリシーをネゴシエートします
* 一致する共有秘密鍵を持っているという結論に従って認証されたディフィーヘルマン交換を実施します。
* IKEフェーズ2パラメータをネゴシエートするためにセキュアトンネル(IKE SA)を確立します

!!! IKEフェーズ2
* 既存のIKE SAによって保護されたIPSecトンネルを確立するためにIPSec SAをネゴシエートします
* IPSec SAを確立します。
* セキュリティを確実にするために定期的にIPSec SAを再ネゴシエートします。
* 任意に、追加のディフィーヘルマン交換を実施します

!!! ISAKMPの生成モード
: メインモード: 
:: 6つのメッセージを交換
:: 認証情報を暗号化
:: 固定アドレスを振られていることが条件

: アグレッシブモード:
:: 3つのメッセージを交換

!! IKEにまかせられる動作
* プロトコルのパラメータを取り決める
* パブリックキーの交換
* 両方の再度の接続性の認証


!!! IKE ポリシーの表示
* 暗号化アルゴリズム、ハッシュアルゴリズム、認証方式、DFグループ、ライフタイムなどが表示される

 # show crypto isakmp policy






! IPSecの高度なチューニング


!! AH 認証ヘッダ
* IPパケットはTransportモードで24バイト、Tunnelモードで44バイト拡大される
* 認証は義務である
* IPSec AHセキュリティプロトコルはデータの機密性を提供しない




! SDMを使用したCisco Easy VPNの設定

* ユーザXauth認証をルータ上でローカルに設定するか、RADIUSサーバで外部的に設定するために、Cisco Easy VPNサーバウィザードを使用することができる。
* SDM Easy VPNサーバーウィザードは、VPN設定を適用する前に要約を表示する


: クイックセットアップ:
:: IPSecピアのアドレスなど必要最小限の項目だけを入力し、それ以外はSDMデフォルトの設定を使用する
:: 設定項目は、VPNEで使用する出力I/F、VPN接続するピアデバイスのアドレス、フェーズ1の認証方式、暗号化するトラフィック

: ステップバイステップウィザード:
:: ユーザが各項目を詳細に設定可能なウィザード
:: デフォルトのポリシーも適用可能
:: GRE over IPSecの設定は不可能
:: 設定項目は、VPNで使用するインタフェース、VPN接続するピアデバイスのアドレス、フェーズ1の認証方式、フェーズ1の認証方式、暗号化するトラフィック
:: オプション設定項目は、IKEフェーズ１ポリシー、IKEフェーズ2ポリシー


!! SDMのサイト間VPNで行うことができる設定
* IPSecを用いたサイトツーサイトVPNの設定
* GRE over IPSecを用いたサイトツーサイトVPNの設定


!! 接続行程
# VPNクライアントがIKEフェーズのプロセスが完了している
# VPNクライアントがISAKMP SAの接続を確立している
# Wasy VPNサーバーがSAの要求を許可する
# VPNサーバーがユーザ名とパスワードのチャレンジングを送付している
# モード設定のプロセスが完了している
# Reverse Route Injectionプロセスが完了している
# IPSecクイックモードの接続が完了している

!! 暗号化するトラフィックの指定方法
* 暗号化ACLの指定
* 送信アドレスまたはあて先アドレスの直接指定
* DNSサーバと連携し、ドメイン名で指定


!! ミラーの生成
* ピアノコンフィギュレーションを自動生成
** フェーズ1、フェーズ2のプロポーザルや事前共有鍵、暗号化ACLなど
* ピア側でcripto mapの割り当てだけ手動で行う必要がある


! ネットワーク攻撃の緩和
!! セキュリティ

* 偵察攻撃
** パケットスニファ
** ポートスキャン
** ping sweeps
** インターネットインフォメーションクエリ

* アクセス攻撃
** パスワード攻撃
** トラストの悪用
** ポートリダイレクション
** 中間者攻撃

! Ciscoルータ自身の保護

! 攻撃からの保護とネットワーク管理機能

: IPスプーフィング:
:: 送信元IPアドレスを偽装する攻撃技術です。DoS攻撃に使用されます。


!! 検査ルールの定義

 (config)# ip inspect

noをつけるとプロトコルの検査ルールを取り消すことができる。

 (config)# no ip inspect

* CABC構成がすべて削除される
* グローバルなタイムアウトおよび閾値がデフォルトになる
* 既存のセッションがすべて切断される



!! ハーフオープンセッション数の制限
 ip inspect max-incomplete low
